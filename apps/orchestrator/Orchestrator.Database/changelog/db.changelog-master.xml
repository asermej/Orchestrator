<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:pro="http://www.liquibase.org/xml/ns/pro"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
        http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd">

    <include file="changes/001-initial-schema.xml" relativeToChangelogFile="true"/>
    <include file="changes/002-add-entity-columns.xml" relativeToChangelogFile="true"/>
    <include file="changes/20250721164527-User.xml" relativeToChangelogFile="true"/>
    <include file="changes/20250803221140-drop-personas-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251101191839-Persona.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251102211018-PersonaChat.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251101212808-ChatMessage.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251102165049-add-auth0-sub-to-users.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251102194839-make-user-names-optional.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251107205122-Topic.xml" relativeToChangelogFile="true"/>
    <!-- PersonaTopic table removed in favor of direct topic ownership - see 20251108224220-refactor-topics-remove-persona-topic.xml -->
    <!-- <include file="changes/20251107205908-PersonaTopic.xml" relativeToChangelogFile="true"/> -->
    <include file="changes/20251107212943-ChatTopic.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251107213332-add-training-file-path-to-personas.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108000000-fix-topic-created-by-type.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108003338-Category.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108004033-PersonaCategory.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108004519-AddCategoryToTopics.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108025302-insert-general-category.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108025322-create-tags-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108025336-create-topic-tags-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108025352-update-topics-category-not-null.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108033228-rename-persona-chats-to-chats.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108044047-rename-chat-messages-to-messages.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108205501-add-profile-image-to-users.xml" relativeToChangelogFile="true"/>
    <!-- 20251108223132-add-persona-id-to-topics.xml superseded by comprehensive refactor below -->
    <include file="changes/20251108224220-refactor-topics-remove-persona-topic.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251108230840-fix-created-by-type.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251110000000-fix-persona-display-name-unique-constraint.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251110000001-expand-topic-content-fields.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251109221220-clean-topic-content-urls.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251109221256-add-content-url-constraint.xml" relativeToChangelogFile="true"/>
    <include file="changes/20251112185859-make-topic-content-required.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260131120000-add-voice-config-to-personas.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201120000-add-voice-metadata-to-personas.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201120001-create-consent-audit-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201120002-create-voice-clone-jobs-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201130000-create-stock-voices-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201130001-seed-stock-voices.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201140000-add-style-lane-to-voice-clone-jobs.xml" relativeToChangelogFile="true"/>
    
    <!-- ATS Platform Reset and New Schema -->
    <include file="changes/20260201150000-ats-platform-reset.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150001-Organization.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150002-Persona.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150003-JobType.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150004-InterviewQuestion.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150005-Applicant.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150006-Job.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150007-Interview.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150008-InterviewResponse.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150009-InterviewResult.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260201150010-Webhook.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 3: Rename Persona to Agent -->
    <include file="changes/20260202000000-rename-personas-to-agents.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 4: Interview Configurations (replacement for JobTypes) -->
    <include file="changes/20260202010000-create-interview-configurations-table.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 5: Remove first_name/last_name from agents -->
    <include file="changes/20260203000000-drop-agent-name-columns.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 6: Fix consent_audit table - rename persona_id to agent_id -->
    <include file="changes/20260203120000-fix-consent-audit-agent-column.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 7: Remove voice cloning feature -->
    <include file="changes/20260203150000-remove-voice-cloning.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 8: Make interview_responses.question_id nullable for test interviews -->
    <include file="changes/20260203160000-make-interview-response-question-nullable.xml" relativeToChangelogFile="true"/>
    
    <!-- Phase 9: Follow-up Questions Feature -->
    <include file="changes/20260203063816-create-follow-up-templates-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260203063817-create-follow-up-selection-logs-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260203063818-add-follow-ups-enabled-to-interview-questions.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260203063819-add-follow-up-template-id-to-interview-responses.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260203063820-add-follow-ups-to-interview-configuration-questions.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260203152841-add-interview-config-question-id-to-follow-up-templates.xml" relativeToChangelogFile="true"/>
    
    <!-- Remove Tags, JobTypes, and Topics -->
    <include file="changes/20260203145454-remove-tags-jobtypes-topics.xml" relativeToChangelogFile="true"/>

    <!-- Remove Category concept: drop agent_categories if present -->
    <include file="changes/20260211120000-drop-agent-categories-if-exists.xml" relativeToChangelogFile="true"/>

    <!-- Candidate Interview Links: invite, session, and audit log tables -->
    <include file="changes/20260214120000-InterviewInvite.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260214120001-CandidateSession.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260214120002-InterviewAuditLog.xml" relativeToChangelogFile="true"/>

    <!-- Add interview_configuration_id to interviews for question loading -->
    <include file="changes/20260214150000-add-interview-configuration-id-to-interviews.xml" relativeToChangelogFile="true"/>

    <!-- Add per-question scores JSON to interview results -->
    <include file="changes/20260215120000-add-question-scores-to-interview-results.xml" relativeToChangelogFile="true"/>

    <!-- Interview Guides: Reusable question sets with opening/closing templates -->
    <include file="changes/20260215162700-create-interview-guides-table.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260215162701-add-interview-guide-id-to-interview-configurations.xml" relativeToChangelogFile="true"/>
    <include file="changes/20260215162702-add-interview-guide-question-id-to-follow-up-templates.xml" relativeToChangelogFile="true"/>

    <!-- Multi-Tenant: Rename organizations to groups + add ATS org scoping -->
    <include file="changes/20260215180000-rename-organizations-to-groups.xml" relativeToChangelogFile="true"/>

    <!-- Simplify InterviewConfiguration: remove config-level questions and scoring rubric -->
    <include file="changes/20260216120000-drop-interview-configuration-questions-and-scoring-rubric.xml" relativeToChangelogFile="true"/>

    <!-- Webhook cleanup: drop unused webhook_configs and webhook_deliveries tables -->
    <include file="changes/20260216150000-drop-unused-webhook-tables.xml" relativeToChangelogFile="true"/>

    <!-- Add ats_api_key to groups for Orchestratorâ†’ATS callback authentication -->
    <include file="changes/20260216160000-add-ats-api-key-to-groups.xml" relativeToChangelogFile="true"/>

    <!-- Agent visibility scope: migrate owner_only to organization_only + add CHECK constraint -->
    <include file="changes/20260216180000-agent-visibility-scope-values.xml" relativeToChangelogFile="true"/>

    <!-- Interview Guide visibility scope: migrate owner_only to organization_only + add CHECK constraint -->
    <include file="changes/20260216190000-interview-guide-visibility-scope-values.xml" relativeToChangelogFile="true"/>
</databaseChangeLog> 